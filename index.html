<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«æ¨‚ç‡Ÿé¤Šç®¡å®¶</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2ecc71">
    <link rel="apple-touch-icon" href="calorie_icon.png">
    <link rel="icon" type="image/png" href="calorie_icon.png">
    
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .manual-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .manual-grid input { width: 100%; font-size: 14px; }
        .small-input-group { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-bottom: 10px; }
        .small-input-group input { padding: 8px; font-size: 12px; }
        .macro-goal-box { background: rgba(46, 204, 113, 0.1); padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.9em; line-height: 1.6; color: var(--text-color); }
        
        /* âœ¨ æ–°å¢ï¼šå¯µç‰©æ¨¡å¼æ¨£å¼ */
        .pet-card {
            background: white; /* é è¨­ç™½åº•ï¼Œæœƒè¢« dark mode è¦†è“‹ */
            background: var(--card-bg);
            border-radius: 16px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 12px var(--shadow-color);
            margin-bottom: 20px;
            border: 2px solid var(--primary-color);
            transition: 0.3s;
        }
        .pet-image {
            max-width: 120px;
            height: auto;
            display: block;
            margin: 0 auto;
        }
        .pet-message {
            margin-top: 10px;
            font-weight: bold;
            color: var(--primary-dark);
            font-size: 1.1em;
            background: rgba(46, 204, 113, 0.2);
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    
    <div class="pet-card" id="pet-section">
        <img id="pet-img" class="pet-image" src="dog_animation/dog_idle.gif" alt="Pet">
        <div id="pet-msg" class="pet-message">æ±ªï¼ä»Šå¤©æƒ³åƒä»€éº¼å‘¢ï¼Ÿ</div>
    </div>

    <div class="date-control">
        <label id="txt-date-label">ğŸ“… ç´€éŒ„æ—¥æœŸï¼š</label>
        <input type="date" id="current-date">
    </div>

    <div class="dashboard-header">
        <div class="label" id="txt-total-intake">ä»Šæ—¥æ”å–</div>
        <div class="big-cal" id="total-cal-display">0</div>
        <div class="label">
            <span id="txt-kcal-unit">kcal</span> / 
            <span id="txt-goal-label">ç›®æ¨™</span> 
            <span id="target-cal-display">--</span>
        </div>
        <div class="nutrition-grid">
            <div class="nutri-box"><span class="n-val" id="sum-protein">0</span><span class="n-label" id="lbl-pro">è›‹ç™½è³ª</span></div>
            <div class="nutri-box"><span class="n-val" id="sum-fat">0</span><span class="n-label" id="lbl-fat">è„‚è‚ª</span></div>
            <div class="nutri-box"><span class="n-val" id="sum-carb">0</span><span class="n-label" id="lbl-carb">ç¢³æ°´</span></div>
            <div class="nutri-box"><span class="n-val" id="sum-sugar">0</span><span class="n-label" id="lbl-sugar">ç³–</span></div>
            <div class="nutri-box"><span class="n-val" id="sum-sodium">0</span><span class="n-label" id="lbl-sod">éˆ‰(mg)</span></div>
            <div class="nutri-box"><span class="n-val" id="sum-sat-fat">0</span><span class="n-label" id="lbl-sat">é£½å’Œè„‚è‚ª</span></div>
            <div class="nutri-box"><span class="n-val" id="sum-trans-fat">0</span><span class="n-label" id="lbl-trans">åå¼è„‚è‚ª</span></div>
            <div class="nutri-box"><span class="n-val" id="water-val">--</span><span class="n-label" id="lbl-water">ç›®æ¨™æ°´</span></div>
        </div>
    </div>

    <div class="card">
        <h3 id="txt-chart-title">ğŸ“Š ç‡Ÿé¤Šèˆ‡ç†±é‡åˆ†æ</h3>
        <div class="chart-grid">
            <div class="chart-container" style="height:200px;"><canvas id="macroChart"></canvas></div>
            <div class="chart-container" style="height:200px;"><canvas id="weeklyChart"></canvas></div>
        </div>
    </div>

    <div class="card">
        <h2 style="color: var(--accent-color);" id="txt-ai-title">ğŸ“¸ AI é£²é£Ÿåˆ†æ</h2>
        <div style="text-align: center;">
            <input type="file" id="image-upload" accept="image/*" style="display: none;">
            <button class="btn-ai" id="btn-take-photo">ğŸ“¸ 1. æ‹ç…§ / é¸æ“‡åœ–ç‰‡</button>
            <div id="ai-desc-group" style="display:none; margin-top: 15px;">
                <textarea id="ai-desc" rows="2" style="width:100%; padding:10px; border-radius:10px;" placeholder="ğŸ“ è£œå……èªªæ˜ (ä¾‹å¦‚ï¼šé€™æ˜¯ä¸€ç¢—ç‰›è‚‰éºµï¼Œæ²’åŠ è”¥)..."></textarea>
            </div>
            <button id="analyze-btn" class="btn-analyze">âœ¨ 2. <span id="txt-analyze-btn">é€å‡ºåœ–ç‰‡åˆ†æ</span></button>
        </div>
        <div class="loading-spinner" id="ai-loading">ğŸ¤– <span id="txt-ai-loading">AI æ­£åœ¨åˆ†æ...</span></div>
        <img id="image-preview">
    </div>

    <div class="card">
        <h3>ğŸ½ï¸ <span id="display-date-text">ä»Šæ—¥</span> <span id="txt-record-title">é£²é£Ÿç´€éŒ„</span></h3>
        <div id="meal-sections-container"></div>
        
        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px dashed #ddd;">
            <label id="txt-manual-label">æ‰‹å‹•è£œå……</label>
            
            <div class="manual-grid">
                <input type="text" id="manual-name" placeholder="é£Ÿç‰©åç¨± (å¿…å¡«)">
                <input type="number" id="manual-cal" placeholder="ç†±é‡ kcal (å¿…å¡«)">
            </div>
            
            <div class="small-input-group">
                <input type="number" id="manual-pro" placeholder="è›‹ç™½è³ª">
                <input type="number" id="manual-fat" placeholder="è„‚è‚ª">
                <input type="number" id="manual-carb" placeholder="ç¢³æ°´">
                <input type="number" id="manual-sugar" placeholder="ç³–">
            </div>
            <div class="small-input-group">
                <input type="number" id="manual-sod" placeholder="éˆ‰(mg)">
                <input type="number" id="manual-sat" placeholder="é£½å’Œè„‚">
                <input type="number" id="manual-trans" placeholder="åå¼è„‚">
                <select id="manual-type"></select>
            </div>

            <button id="btn-add-record" style="background-color: #95a5a6;">â• åŠ å…¥ç´€éŒ„</button>
            <div class="fav-controls">
                <button class="btn-fav-save" id="btn-fav-save-main">â¤ï¸ <span id="btn-fav-save">åŠ å…¥æœ€æ„›</span></button>
                <button class="btn-fav-load" id="btn-fav-load-main">ğŸ“‚ <span id="btn-fav-load">é¸æ“‡å¸¸åƒé£Ÿç‰©</span></button>
            </div>
        </div>
    </div>

    <div class="card">
        <h3 id="txt-settings-title">âš™ï¸ å€‹äººæ•¸æ“šè¨­å®š</h3>
        <div class="form-group">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div><label id="lbl-gender">æ€§åˆ¥</label><select id="gender"><option id="opt-male" value="male">ç”·</option><option id="opt-female" value="female">å¥³</option></select></div>
                <div><label id="lbl-age">å¹´é½¡</label><input type="number" id="age" placeholder="25"></div>
                <div><label id="lbl-height">èº«é«˜</label><input type="number" id="height" placeholder="170"></div>
                <div><label id="lbl-weight">é«”é‡</label><input type="number" id="weight" placeholder="60"></div>
            </div>
            
            <label style="margin-top: 10px;" id="lbl-activity">æ´»å‹•é‡</label>
            <select id="activity">
                <option id="opt-act-1" value="1.2">ä¹…å (è¾¦å…¬å®¤)</option>
                <option id="opt-act-2" value="1.375">è¼•åº¦ (æ¯é€±é‹å‹•1-3å¤©)</option>
                <option id="opt-act-3" value="1.55">ä¸­åº¦ (æ¯é€±é‹å‹•3-5å¤©)</option>
                <option id="opt-act-4" value="1.725">é«˜åº¦ (æ¯é€±é‹å‹•6-7å¤©)</option>
            </select>
            
            <label style="margin-top: 10px;" id="lbl-meal-mode">ğŸ½ï¸ æ¯æ—¥é¤æ•¸æ¨¡å¼</label>
            <select id="meal-mode">
                <option id="opt-mode-4" value="4" selected>æ¨™æº– (3é¤+é»å¿ƒ)</option>
                <option id="opt-mode-3" value="3">3é¤ (ç„¡é»å¿ƒ)</option>
                <option id="opt-mode-2" value="2">2é¤ (168æ–·é£Ÿ)</option>
                <option id="opt-mode-1" value="1">1é¤ (OMAD)</option>
            </select>
            
            <button id="btn-calc" style="margin-top: 15px;">ğŸ”„ å„²å­˜ä¸¦æ›´æ–°ä»‹é¢</button>
        </div>
        
        <div id="goal-result" class="goal-section">
            <span id="txt-res-tdee">TDEE</span> <span style="font-size:0.8em; opacity:0.8;">(æ¯æ—¥ç¸½æ¶ˆè€—ç†±é‡)</span>ï¼š<span id="tdee-val">0</span> kcal<br>
            <span id="txt-res-target">æ¸›é‡ç›®æ¨™</span>ï¼š<span id="target-cal-val">0</span> kcal
            <div id="macro-goals" class="macro-goal-box"></div>
        </div>
    </div>
</div>

<div class="modal-overlay" id="analysis-modal"><div class="modal"><h3>âœ¨ <span id="txt-modal-title">AI åˆ†æå ±å‘Š</span></h3><div class="analysis-result" id="analysis-content"></div><button id="btn-ai-fav-save" class="btn-fav-save" style="margin-bottom: 15px; width: 100%;">â¤ï¸ <span id="btn-fav-ai">åŠ å…¥æœ€æ„›</span></button><p id="txt-modal-ask">è«‹å•é€™æ˜¯å“ªä¸€é¤ï¼Ÿ</p><div class="meal-selector" id="modal-meal-buttons"></div><button id="btn-cancel" style="margin-top: 15px; background: #95a5a6;">å–æ¶ˆ</button></div></div>
<div class="modal-overlay" id="fav-modal"><div class="modal"><h3>â¤ï¸ <span id="txt-fav-title">å¸¸åƒé£Ÿç‰©æ¸…å–®</span></h3><div style="max-height: 300px; overflow-y: auto; text-align: left;" id="fav-list-container"></div><button id="btn-fav-close" style="margin-top: 15px; background: #95a5a6;">é—œé–‰</button></div></div>
<div class="modal-overlay" id="lang-modal" style="display:none;"><div class="lang-modal-box"><div class="lang-modal-title" id="txt-lang-title">èªè¨€</div><div class="lang-list"><div class="lang-option" data-lang="zh-TW">ç¹é«”ä¸­æ–‡</div><div class="lang-option" data-lang="zh-CN">ç®€ä½“ä¸­æ–‡</div><div class="lang-option" data-lang="en">English</div><div class="lang-option" data-lang="ja">æ—¥æœ¬èª</div></div><button class="lang-cancel-btn" id="btn-lang-cancel">å–æ¶ˆ</button></div></div>

<div class="fab-container"><div class="fab-menu" id="fab-menu"><div class="fab-item" id="btn-toggle-theme">ğŸŒ“ <span id="menu-theme">æ·±è‰²æ¨¡å¼</span></div><div class="fab-item" id="btn-open-lang">ğŸŒ <span id="menu-lang">èªè¨€</span></div><label class="fab-item">ğŸ“¥ <span id="menu-import">åŒ¯å…¥é‚„åŸ</span><input type="file" id="import-file" style="display:none" accept=".json"></label><div class="fab-item" id="btn-export">ğŸ“¤ <span id="menu-export">åŒ¯å‡ºå‚™ä»½</span></div></div><div class="fab-main" id="btn-fab-main"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></div></div>

<script src="js/config.js"></script>
<script src="js/utils.js"></script>
<script src="js/data.js"></script>
<script src="js/api.js"></script>
<script src="js/ui.js"></script>
<script src="js/app.js"></script>
</body>
</html>
