<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«æ¨‚å°ç‹—æ‰“æ“Šå¡è·¯é‡Œ</title>
    <style>
        /* CSS å‡ç´šå€åŸŸ: é«˜ç´šæ„Ÿè¦–è¦ºé¢¨æ ¼ */
        :root {
            --primary-color: #00bcd4; /* ä¸»è¦å¼·èª¿è‰²: å†·é’è‰²/Teal */
            --secondary-color: #0097a7; /* æ·±è‰²å¼·èª¿è‰² */
            --bg-color: #f5f7fa; /* æ·ºè‰²èƒŒæ™¯: å¾®å†·èª¿ç° */
            --card-bg: #ffffff;
            --dark-text: #2c3e50; /* ä¸»æ–‡å­—è‰²: ç‚­ç°/æ·±è— */
            --shadow: 0 6px 20px rgba(0, 0, 0, 0.08); /* ç´°è†©é™°å½± */
            --border-radius: 12px;
        }

        body {
            font-family: 'Segoe UI', Roboto, "Microsoft JhengHei", sans-serif;
            background-color: var(--bg-color);
            color: var(--dark-text);
            margin: 0;
            padding: 30px 20px; /* å¢åŠ ä¸Šä¸‹é–“è· */
            display: flex;
            justify-content: center;
        }

        .container {
            max-width: 850px;
            width: 100%;
            display: grid;
            gap: 25px; /* å¢åŠ å€å¡Šé–“è· */
        }

        h1 { 
            text-align: center; 
            color: var(--secondary-color); 
            margin-bottom: 15px;
            font-size: 2.2em;
            font-weight: 300; /* è®“æ¨™é¡Œæ›´ç¾ä»£ã€çº–ç´° */
            letter-spacing: 1px;
        }
        h2 { 
            text-align: center; 
            color: var(--dark-text); 
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 5px;
            display: inline-block;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* å¡ç‰‡é€šç”¨æ¨£å¼ */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 30px; 
            box-shadow: var(--shadow); /* æ‡‰ç”¨é«˜ç´šé™°å½± */
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-2px); /* è¼•å¾®ä¸Šæµ®æ•ˆæœ */
        }

        /* è¡¨å–®æ¨£å¼ */
        label { margin-bottom: 8px; font-weight: 600; }
        input, select {
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            transition: border-color 0.3s;
        }
        input:focus, select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 5px rgba(0, 188, 212, 0.3);
            outline: none;
        }

        button {
            padding: 14px;
            background-color: var(--primary-color);
            box-shadow: 0 4px 10px rgba(0, 188, 212, 0.4);
            transition: background 0.3s, box-shadow 0.3s;
        }
        button:hover { 
            background-color: var(--secondary-color); 
            box-shadow: 0 4px 12px rgba(0, 151, 167, 0.6);
        }

        /* çµæœå„€è¡¨æ¿ç¶²æ ¼ */
        .dashboard-grid {
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); /* å¢åŠ æœ€å°å¯¬åº¦ */
        }

        .stat-box {
            background: var(--bg-color); /* æ•¸æ“šèƒŒæ™¯è‰²èˆ‡é é¢èƒŒæ™¯è‰²ä¸€è‡´ */
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            padding: 20px 10px;
        }
        .stat-value { 
            font-size: 32px; /* æ”¾å¤§æ•¸å€¼ */
            font-weight: 700; 
            color: var(--secondary-color); /* æ·±è‰²å¼·èª¿ */
            letter-spacing: -0.5px;
        }
        .stat-label { font-size: 15px; color: #7f8c8d; margin-top: 5px; }

        /* æ¸›é‡å»ºè­°ç‰¹åˆ¥å¼·èª¿ */
        #diet-cal-val {
            color: #d35400; /* ä½¿ç”¨å¼·çƒˆæš–è‰²å¼·èª¿ç›®æ¨™ */
        }
        .stat-box[style*="d4edda"] {
             background-color: #fff3e0 !important; /* æ·ºæ©˜/é»ƒè‰² */
             border-color: #ffb74d !important;
        }

        /* é£Ÿç‰©æ¸…å–® */
        #food-list li {
            background: var(--card-bg);
            border-bottom: none;
            border-radius: 4px;
            margin-bottom: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05); /* è¼•å¾®é‚Šæ¡†é™°å½± */
        }
        .total-cal {
            border-top: 2px solid var(--dark-text);
            padding-top: 15px;
            margin-top: 20px;
        }
        
        .advice-box {
            background-color: #e0f7fa; /* æ·ºé’è‰²åº• */
            border-left: 5px solid var(--primary-color);
            color: var(--dark-text);
        }
        .search-button {
            background-color: #34495e; /* æ·±ç‚­ç°è‰² */
            box-shadow: none;
        }
        .search-button:hover {
             background-color: #1f3044;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ¶å¡è·¯é‡Œå„€è¡¨æ¿ğŸ¶</h1>

    <div class="card">
        <h2>æ­¥é©Ÿä¸€ï¼šè¨­å®šå€‹äººæª”æ¡ˆ</h2>
        <div class="form-group">
            <label>æ€§åˆ¥</label>
            <select id="gender">
                <option value="male">ç”·</option>
                <option value="female">å¥³</option>
            </select>
        </div>
        <div class="form-group">
            <label>å¹´é½¡ (æ­²)</label>
            <input type="number" id="age" placeholder="ä¾‹å¦‚: 25">
        </div>
        <div class="form-group">
            <label>èº«é«˜ (cm)</label>
            <input type="number" id="height" placeholder="ä¾‹å¦‚: 175">
        </div>
        <div class="form-group">
            <label>é«”é‡ (kg)</label>
            <input type="number" id="weight" placeholder="ä¾‹å¦‚: 70">
        </div>
        <div class="form-group">
            <label>æ—¥å¸¸æ´»å‹•é‡</label>
            <select id="activity">
                <option value="1.2">ä¹…å (å¹¾ä¹ä¸é‹å‹•)</option>
                <option value="1.375">è¼•åº¦æ´»å‹• (æ¯é€±é‹å‹• 1-3 å¤©)</option>
                <option value="1.55">ä¸­åº¦æ´»å‹• (æ¯é€±é‹å‹• 3-5 å¤©)</option>
                <option value="1.725">é«˜åº¦æ´»å‹• (æ¯é€±é‹å‹• 6-7 å¤©)</option>
            </select>
        </div>
        <button onclick="calculateProfile()">è¨ˆç®—æˆ‘çš„å¥åº·æ•¸æ“š</button>
    </div>

    <div class="card" id="result-section" style="display:none;">
        <h2>æ‚¨çš„æ¯æ—¥ç›®æ¨™</h2>
        <div class="dashboard-grid">
            <div class="stat-box">
                <div class="stat-value" id="tdee-val">0</div>
                <div class="stat-label">TDEE (ç¶­æŒé«”é‡)</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="water-val">0</div>
                <div class="stat-label">å»ºè­°é£²æ°´é‡ (ml)</div>
            </div>
            <div class="stat-box" style="background-color: #d4edda;">
                <div class="stat-value" id="diet-cal-val">0</div>
                <div class="stat-label">æ¸›é‡å»ºè­°æ”å–</div>
            </div>
        </div>
        <div class="advice-box" id="advice-text">
            </div>
    </div>

    <div class="card">
        <h2>æ­¥é©ŸäºŒï¼šä»Šæ—¥é£²é£Ÿç´€éŒ„</h2>

        <div class="form-group">
            <label>é¸æ“‡å¸¸è¦‹é£Ÿç‰©ï¼ˆå¿«é€Ÿç´€éŒ„ï¼‰</label>
            <div style="display: flex; gap: 10px;">
                <select id="quick-food" onchange="fillCalorie()" style="flex: 2;">
                    <option value="0">--- è«‹é¸æ“‡é£Ÿç‰© ---</option>
                    </select>
                <input type="number" id="quick-food-cal" placeholder="ç†±é‡ (å¡)" disabled style="flex: 1; background-color: #f1f1f1;">
            </div>
            <button onclick="addQuickFood()">åŠ å…¥æ¸…å–® (é¸å–®)</button>
        </div>


        <div class="food-manual-input">
            <label>æ‰‹å‹•è¼¸å…¥é£Ÿç‰©ï¼ˆæ™ºæ…§æœå°‹ç†±é‡ï¼‰</label>
            <div class="food-input-group">
                <input type="text" id="food-name" placeholder="é£Ÿç‰©åç¨± (ä¾‹å¦‚: çç å¥¶èŒ¶)">
                <input type="number" id="food-cal" placeholder="ç†±é‡ (å¤§å¡)">
                <button onclick="searchCalorie()" class="search-button">æ™ºæ…§æœå°‹ç†±é‡ ğŸ”</button>
                <button onclick="addFood()">åŠ å…¥æ¸…å–® (æ‰‹å‹•)</button>
            </div>
        </div>

        <ul id="food-list">
            </ul>
        
        <div class="total-cal">
            ä»Šæ—¥å·²æ”å–: <span id="total-intake" style="color: var(--primary-color);">0</span> kcal
            <div style="font-size: 14px; color: #666; margin-top: 5px;">
                æ¸›é‡ç›®æ¨™å‰©é¤˜é¡åº¦: <span id="remaining-cal">è«‹å…ˆè¨ˆç®—å€‹äººæ•¸æ“š</span> kcal
            </div>
        </div>
    </div>
</div>

<script>
    // å…¨åŸŸè®Šæ•¸ï¼Œç”¨ä¾†å„²å­˜è¨ˆç®—çµæœ
    let currentTDEE = 0;
    let dietCalories = 0;
    let totalIntake = 0;
    let foodItems = []; 

    // é£Ÿç‰©è³‡æ–™åº« (Food Database)
    const FOOD_DB = {
        'æ°´ç…®è›‹ (1é¡†)': 78,
        'é¦™è•‰ (1æ ¹)': 105,
        'å¾¡é£¯ç³° (é®ªé­š)': 200,
        'é›èƒ¸è‚‰ (100å…‹)': 165,
        'ç™½é£¯ (1ç¢—/200å…‹)': 280,
        'æ»·è‚‰é£¯ (1ç¢—)': 650,
        'é›è…¿ä¾¿ç•¶ (å»çš®)': 600,
        'çç å¥¶èŒ¶ (å…¨ç³–)': 550,
        'ç¾å¼å’–å•¡ (å¤§æ¯)': 10
    };

    // --- è¼‰å…¥èˆ‡å„²å­˜å€‹äººè³‡æ–™åŠé£²é£Ÿç´€éŒ„åŠŸèƒ½ ---

    document.addEventListener('DOMContentLoaded', (event) => {
        // ç”Ÿæˆé£Ÿç‰©é¸å–®
        const select = document.getElementById('quick-food');
        for (const [name, cal] of Object.entries(FOOD_DB)) {
            const option = document.createElement('option');
            option.value = cal;
            option.textContent = name;
            select.appendChild(option);
        }
        
        // è¼‰å…¥æ‰€æœ‰è³‡æ–™ (å€‹äººæª”æ¡ˆ + é£Ÿç‰©æ¸…å–®)
        loadProfile();
    });

    // å„²å­˜è³‡æ–™å‡½æ•¸ï¼šåŒ…å«å€‹äººæª”æ¡ˆå’Œé£Ÿç‰©æ¸…å–®
    function saveProfile() {
        // 1. å„²å­˜å€‹äººæª”æ¡ˆ
        const profileFields = ['gender', 'age', 'height', 'weight', 'activity'];
        profileFields.forEach(id => {
            const value = document.getElementById(id).value;
            localStorage.setItem(id, value);
        });

        // 2. å„²å­˜é£Ÿç‰©æ¸…å–® (å°‡ foodItems é™£åˆ—è½‰æ›æˆ JSON å­—ä¸²)
        localStorage.setItem('foodItems', JSON.stringify(foodItems));
    }

    // è¼‰å…¥è³‡æ–™å‡½æ•¸ï¼šåŒ…å«å€‹äººæª”æ¡ˆå’Œé£Ÿç‰©æ¸…å–®
    function loadProfile() {
        // 1. è¼‰å…¥å€‹äººæª”æ¡ˆ
        const profileFields = ['gender', 'age', 'height', 'weight', 'activity'];
        profileFields.forEach(id => {
            const value = localStorage.getItem(id);
            const element = document.getElementById(id);
            if (value && element) {
                element.value = value;
            }
        });

        // 2. è¼‰å…¥é£Ÿç‰©æ¸…å–®
        const storedFoods = localStorage.getItem('foodItems');
        if (storedFoods) {
            foodItems = JSON.parse(storedFoods); 
            totalIntake = 0;
            foodItems.forEach(item => {
                // é‡æ–°æ¸²æŸ“é£Ÿç‰©æ¸…å–®åˆ° DOM (å‚³å…¥ false è¡¨ç¤ºé€™æ¬¡æ˜¯è¼‰å…¥ï¼Œä¸éœ€è¦å†æ¬¡å„²å­˜)
                addFoodToDOM(item.name, item.cal, false); 
            });
            document.getElementById('total-intake').innerText = totalIntake;
        }

        // 3. å˜—è©¦è‡ªå‹•è¨ˆç®—å€‹äººæ•¸æ“š
        if (localStorage.getItem('age') && localStorage.getItem('height') && localStorage.getItem('weight')) {
             calculateProfile(true); 
        }
    }


    // åŠŸèƒ½ 1 & 2 & 4: è¨ˆç®—å€‹äººæ•¸æ“š (BMR, TDEE, æ°´)
    function calculateProfile(isAutoLoad = false) {
        const gender = document.getElementById('gender').value;
        const age = parseFloat(document.getElementById('age').value);
        const height = parseFloat(document.getElementById('height').value);
        const weight = parseFloat(document.getElementById('weight').value);
        const activity = parseFloat(document.getElementById('activity').value);

        if (!isAutoLoad && (!age || !height || !weight || age <= 0 || height <= 0 || weight <= 0)) {
            alert("è«‹å®Œæ•´å¡«å¯«æœ‰æ•ˆçš„å€‹äººè³‡æ–™ (å¹´é½¡ã€èº«é«˜ã€é«”é‡å¿…é ˆå¤§æ–¼ 0)ï¼");
            return;
        }

        // å„²å­˜æœ€æ–°çš„å€‹äººè³‡æ–™
        saveProfile(); 
        
        // BMR/TDEE/Water è¨ˆç®—é‚è¼¯
        let bmr = 0;
        if (gender === 'male') {
            bmr = (10 * weight) + (6.25 * height) - (5 * age) + 5;
        } else {
            bmr = (10 * weight) + (6.25 * height) - (5 * age) - 161;
        }

        currentTDEE = Math.round(bmr * activity);
        const water = Math.round(weight * 35);
        dietCalories = currentTDEE - 500;
        if (dietCalories < bmr) {
             dietCalories = Math.round(bmr); 
        }

        // æ›´æ–° UI é¡¯ç¤º
        document.getElementById('tdee-val').innerText = currentTDEE;
        document.getElementById('water-val').innerText = water;
        document.getElementById('diet-cal-val').innerText = dietCalories;
        
        // ç˜¦èº«å»ºè­°
        const adviceDiv = document.getElementById('advice-text');
        adviceDiv.style.display = 'block';
        adviceDiv.innerHTML = `
            <strong>ğŸ’¡ ç˜¦èº«å°å»ºè­°ï¼š</strong><br>
            ç‚ºäº†é”åˆ°æ¯é€±ç´„æ¸›é‡ 0.5 å…¬æ–¤ï¼Œå»ºè­°æ‚¨æ¯æ—¥æ”å– <b>${dietCalories}</b> å¤§å¡ã€‚<br>
            è«‹è¨˜å¾—æ¯å¤©è‡³å°‘å– <b>${water}cc</b> çš„æ°´ä¾†å¹«åŠ©ä»£è¬ï¼
        `;

        document.getElementById('result-section').style.display = 'block';
        
        updateRemaining();
    }

    // åŠŸèƒ½ï¼šç•¶é¸æ“‡å¸¸è¦‹é£Ÿç‰©æ™‚ï¼Œè‡ªå‹•å¡«å…¥ç†±é‡
    function fillCalorie() {
        const cal = document.getElementById('quick-food').value;
        document.getElementById('quick-food-cal').value = cal > 0 ? cal : '';
    }

    // åŠŸèƒ½ï¼šåŠ å…¥å¸¸è¦‹é£Ÿç‰©
    function addQuickFood() {
        const selectElement = document.getElementById('quick-food');
        const cal = parseFloat(selectElement.value);
        const name = selectElement.options[selectElement.selectedIndex].text;

        if (cal <= 0 || name === '--- è«‹é¸æ“‡é£Ÿç‰© ---') {
            alert("è«‹é¸æ“‡ä¸€å€‹é£Ÿç‰©é …ç›®ï¼");
            return;
        }

        addFoodToDOM(name, cal, true); 
        
        selectElement.value = '0';
        document.getElementById('quick-food-cal').value = '';
    }
    
    // åŠŸèƒ½ï¼šæ™ºæ…§æœå°‹ç†±é‡
    function searchCalorie() {
        const foodName = document.getElementById('food-name').value;
        if (!foodName) {
            alert("è«‹å…ˆè¼¸å…¥æ‚¨è¦æŸ¥è©¢çš„é£Ÿç‰©åç¨±ï¼");
            return;
        }
        
        const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(foodName + " ç†±é‡ å¤§å¡")}`;
        window.open(searchUrl, '_blank');
    }

    // åŠŸèƒ½ï¼šåŠ å…¥æ‰‹å‹•è¼¸å…¥çš„é£Ÿç‰©
    function addFood() {
        const name = document.getElementById('food-name').value;
        const cal = parseFloat(document.getElementById('food-cal').value);

        if (!name || isNaN(cal) || cal <= 0) {
            alert("è«‹è¼¸å…¥æ­£ç¢ºçš„é£Ÿç‰©åç¨±å’Œç†±é‡æ•¸å­—ï¼");
            return;
        }

        addFoodToDOM(name, cal, true); 

        document.getElementById('food-name').value = '';
        document.getElementById('food-cal').value = '';
    }

    // æ ¸å¿ƒï¼šå°‡é£Ÿç‰©åŠ å…¥æ¸…å–®çš„å…±ç”¨é‚è¼¯
    function addFoodToDOM(name, cal, shouldSave) {
        // å¦‚æœæ˜¯æ–°å¢ï¼Œå‰‡åŠ å…¥ foodItems é™£åˆ—ä¸¦é‡æ–°è¨ˆç®—ç¸½ç†±é‡
        if (shouldSave) {
            foodItems.push({ name: name, cal: cal }); 
            totalIntake += cal; 
            saveProfile(); 
        }

        // æ–°å¢åˆ°åˆ—è¡¨ UI
        const list = document.getElementById('food-list');
        const li = document.createElement('li');
        li.setAttribute('data-name', name);
        li.setAttribute('data-cal', cal);

        li.innerHTML = `
            <span>${name}</span> 
            <span>${cal} kcal
                <button onclick="deleteFood(this)" style="width: auto; padding: 2px 5px; margin-left: 10px; background-color: #e74c3c;">X</button>
            </span>
        `;
        list.appendChild(li);

        document.getElementById('total-intake').innerText = totalIntake;
        updateRemaining();
    }

    // åŠŸèƒ½ï¼šåˆªé™¤é£Ÿç‰©é …ç›®
    function deleteFood(buttonElement) {
        const listItem = buttonElement.closest('li');
        const calToRemove = parseFloat(listItem.getAttribute('data-cal'));
        const nameToRemove = listItem.getAttribute('data-name');
        
        // 1. å¾ foodItems é™£åˆ—ä¸­ç§»é™¤è©²é …ç›®
        const index = foodItems.findIndex(item => item.name === nameToRemove && item.cal === calToRemove);
        if (index > -1) {
            foodItems.splice(index, 1);
        }

        // 2. å¾ç¸½è¨ˆä¸­æ‰£é™¤ç†±é‡
        totalIntake -= calToRemove;
        document.getElementById('total-intake').innerText = totalIntake;

        // 3. å¾ DOM ä¸­ç§»é™¤åˆ—è¡¨é …
        listItem.remove();

        // 4. é‡æ–°å„²å­˜æ¸…å–®
        saveProfile(); 

        // 5. æ›´æ–°å‰©é¤˜é¡åº¦
        updateRemaining();
    }
    
    // æ›´æ–°å‰©é¤˜å¡è·¯é‡Œ
    function updateRemaining() {
        const remainingSpan = document.getElementById('remaining-cal');

        if (dietCalories === 0) {
            remainingSpan.innerText = "è«‹å…ˆè¨ˆç®—å€‹äººæ•¸æ“š";
            remainingSpan.style.color = "#666";
            return;
        }

        const remaining = dietCalories - totalIntake;
        
        remainingSpan.innerText = remaining;

        if (remaining < 0) {
            remainingSpan.style.color = "red";
            remainingSpan.innerText = Math.abs(remaining) + " (å·²è¶…æ¨™!)";
        } else {
            remainingSpan.style.color = "var(--secondary-color)";
        }
    }
</script>

</body>
</html>
